# 1 计算机网络应用体系结构

## 1.1 客户/服务器（C/S）结构网络应用

最典型、最基本的网络应用。

例如：www 应用; 文件传输; 电子邮件;

**特点：** 

1. 网络通信双方为客户程序和服务器程序，用户与用户之间不进行直接通信。
2. 服务器程序先运行，做好接受通信的准备。
3. 客户程序后运行，主动与服务器进行通信。

## 1.2 纯 P2P 结构网络应用

通信双方没有传统意义上的客户服务器之分，地位对等，通信双方都具备客户与服务器的特征。

## 1.3 混合结构网络应用

C/S应用和P2P应用相结合。

# 2 网络应用通信的基本原理

**网络应用的基本通信过程：** 运行在不同主机上的应用进程间以 C/S 方式进行通信。

**网络应用编程接口：** 

- 套接字：  典型的网络应用编程接口。
- 端口号：  表示套接字的编号。

# 3 域名系统（DNS）

**域名解析：**  将域名映射为 IP 地址。

**域名解析的原理：**  为了实现域名解析，域名系统会建立分布式数据库，存储域名与 IP 地址的映射关系数据。

**域名的命名方式：**  层次树状结构命名方式； 每个域名由不同级别的域名组成，哥哥层级域名之间用点分隔。

**顶级域名的分类：**

- 国家顶级域名：  cn , us , uk ...
- 通用顶级域名：  com , org , gov ,edu ...
- 基础结构域名：  arpa  (只有一个，反向域名解析)

**DNS服务器：**  根据其主要保存的域名信息以及在域名解析过程的作用，可分为：

- 根域名服务器： 最重要的服务器，全球有 13 个。 保存所有顶级域名服务器的域名和 IP 地址。
- 顶级域名服务器：负责管理在该顶级域名服务器注册的所有二级域名。
- 权威域名服务器： 保存该区中所有主机的域名和 IP 地址的映射。
- 中间域名服务器： 不是以上三种的域名服务器。
- 本地（默认）域名服务器： 主机在网络地址配置时，都会配置的用于保存被查询域名的信息。

**区：**  一个服务器所负责管辖的范围，DNS服务器的管辖范围不以“域”为单位，而以区为单位。

**递归解析：**  主机进行域名查询时，本地域名服务器没有被查询域名信息，则本地域名服务器代理主机查询根域名服务器。根域名服务器代理本地域名服务器查询下一个域名服务，以此类推。直到得到被查询域名的IP地址，或者无法没有查询到，最后将解析结果发送给主机。

**迭代解析：** 主机进行域名查询时，本地域名服务器没有被查询域名信息，则先求助于根域名服务器。根域名服务器只是将下一步要查询服务器告知查询主机的本地域名服务器，本地域名服务器继续查询下一个域名服务器，直到查询到被查询的域名的IP地址。

# 4 万维网应用

## 4.1 万维网应用结构：

**结构：**

- 浏览器： Web 应用的客户代理。
- web服务器： 存储管理共用户请求浏览的 Web 页面
- HTTP： 客户域服务器间交互的协议。

**URL：**  统一资源定位符，由存放对象的主机域名（或IP地址） + 对象的路径名组成。

## 4.2 HTTP：

### 4.2.1 HTTP概述：   

超文本传输协议，Web 应用的应用层协议，定义浏览器如何向 Web 服务器发送请求，以及 Web 服务器如何进行响应。

### 4.2.2 HTTP连接：   

HTTP基于传输层的 TCP 传输协议。 浏览器在向服务器发送请求之前，首先建立 TCP 连接，然后才发送HTTP 请求报文，接受 HTTP 响应报文。

**RTT：**  从客户发送连接请求，到客户收到服务器连接确认，用时一个往返时间。（Round Trip Time）

**分类：**

- 非持久连接的 HTTP （HTTP1.0）：
  - 单条连接： 用一次断一次。
  - 多条连接： 并行多条，用一次断一次。
- 持久连接的 HTTP （HTTP1.1）:
  - 非流水方式持久连接： 建立TCP 连接，发送请求和接收响应后，不断开 TCP 连接，继续请求。
  - 流水方式持久连接： 建立 TCP 连接，发送请求和接收响应后，不断开 TCP 连接，继续并行请求 3 个 图片。

### 4.2.3 HTTP报文：

|          | 请求报文                        | 响应报文                           |
| -------- | ------------------------------- | ---------------------------------- |
| 起始行   | 请求行：<方法> <URL> <协议版本> | 状态行：<协议版本> <状态码> <短语> |
| 首部行   | 携带附加信息                    | 携带附加信息                       |
| 空白行   | CRLF                            | CRLF                               |
| 报文主体 | 一般没有                        | 一般没有                           |



**方法：**

- GET ： 请求读取由 UTL 所标识的信息，是最常见的方法。
- HEAD： 请求读取由 URL 所标识的信息的首部。
- POST： 给服务器添加信息。
- OPTION： 请求一些选项信息。
- PUT： 在指明的 URL 下存储一个文档。

**状态码：**

| 状态码类别 | 取值范围 | 作用       | 说明                                  |
| ---------- | -------- | ---------- | ------------------------------------- |
| 1xx        | 100-199  | 信息提示   | 通告信息，可能还需要进一步交互        |
| 2xx        | 200-299  | 成功       | 成功完成客户请求的操作，并进行响应    |
| 3xx        | 300-399  | 重定向     | 表示资源已移走，需要向新 URL 发请求。 |
| 4xx        | 400-499  | 客户端错误 | 表示客户端请求错误，无法成功响应      |
| 5xx        | 500-599  | 服务器错误 | 由于服务器端错误，无法成功响应        |

**常见的HTTP状态码：**

| 状态码 | 短语                       | 含义                                       |
| ------ | -------------------------- | ------------------------------------------ |
| 100    | Continue                   | 已成功收到了请求的初始部分，请客户端继续。 |
| 200    | OK                         | 成功，所请求信息在响应报文中。             |
| 301    | Moved Permanently          | 重定向                                     |
| 400    | Bad Request                | 客户端请求错误                             |
| 401    | Unauthorized               | 未授权，需要输入用户名和密码               |
| 404    | Not Found                  | 客户端请求的对象，在服务器上不存在         |
| 451    | Unsupported Media Type     | 不支持的媒体类型                           |
| 505    | HTTP Version Not Supported | 请求使用的 HTTP 版本，服务器不支持。       |

**CRLF：**  回车 CR 换行 LF

## 4.3 Cookie

HTTP服务器不保存客户的任何信息，被称为无状态协议。引入 Cookie 机制，用于用户跟踪。

**小型文本文件（Cookie）：**   网站为了辨别用户身份，进行会话跟踪，而由服务器端生成并存储在用户本地终端上的数据。

**Cookie 技术主要包括 4 部分内容：**

1. HTTP 响应报文中的  Cookie 头行： 用户的 Cookie ID ，用户偏好等。
2. 用户浏览器在本地存储，维护和管理的 Cookie 文件。
3. HTTP 请求报文中的 Cookie 头行：用户已访问过的网站再次访问时，浏览器会检索本地 Cookie 文件。
4. 网站在后台数据库中存储、维护 Cookie 信息： 分配用户ID，每个ID 在本网站的访问特征等。

**Cookie技术最常见的用途：**

1. 网站可以利用Cookie的ID来准确统计网站的实际访问人数、新访问者和重复访问者的人数对比、访问者的访问频率等数据。
2. 网站可以利用Cookie限制某些特定用户的访问。
3. 网站可以存储用户访问过程中的操作习惯和偏好。
4. 记录用户登录网站使用的用户名、密码等信息。
5. 电子商务网站利用Cookie可以实现“购物车”功能。

# 5 Internet 电子邮件

## 5.1 邮件系统结构

**邮件服务器：**  电子邮件体系结构的核心。

功能：

- 用户注册
- 发送和接收邮件
- 分配存储空间
- 向发信人报告邮件传送情况（已交付、被拒绝、丢失等）

**用户代理：**   电子邮件应用的客户端软件。

例如： Outlook、Apple Mail 、 Fox Mail 等 ~

功能：支持用户撰写、显示、处理和收发邮件。为用户阅读、恢复、转发、保存和撰写邮件提供编辑与操作环境。

**简单邮件传输协议（SMTP）**

功能： 实现邮件服务器之间或用户代理到邮件服务器之间的邮件传输。

**邮件读取协议（POP3、IMAP、HTTP）**

- 第三版邮局协议   POP3
- 互联网邮件访问协议  IMAP
- Web邮件系统的邮件读取协议  HTTP 

## 5.2 SMTP 

**功能：**  实现邮件服务器之间或用户代理到邮件服务器之间的邮件传输。

**SMTP 通过3个阶段的应用层交互完成邮件的传输：**

- 握手阶段
- 邮件传输阶段
- 关闭阶段

**SMTP 定义了 14 条命令，每条命令由 4 个字母组成**

- HELO：表示发件人自己的身份；
- DATA：通知服务器准备开始发送邮件内容；
- QUIT：命令退出；

**SMTP定义了21中应答信息，由3位数字的代码开始，后面附上（也可不附）简单的文字说明。**

**SMTP特点：**

- SMTP 只能传送 7 位 ASCLL 码 文本内容，包括 SMTP 命令，应答消息以及邮件内容。
- SMTP 传送的邮件内容中不能包含 “CRLF，CRLF”，因为该信息用户标识邮件内容的结束。
- SMTP 是 “推动” 协议。
- SMTP 使用 TCP 连接时持久的。

## 5.3 电子邮件格式与 MIME

**电子邮件格式：**

- 首部
- 空白行
- 行主体

**邮件中常见的首部行内容：**

| 内容     | 含义                                   |
| -------- | -------------------------------------- |
| To       | 收件人的电子邮件地址（必填行）         |
| Subject  | 邮件的主题                             |
| Cc       | 表示应给某某人发送一个邮件副本（抄送） |
| From     | 表示发信人的电子邮件地址               |
| Date     | 发信日期                               |
| Reply-To | 对方回信所用的地址                     |

**互联网邮件扩展 MIME：**  当传输非 7 位 ASCll 码文本内容时，必须依据一个标准将非 7 位 ASCll 码文本内容转换为 7 位 ASCll 码文本内容，然后再传输

## 5.4 邮件读取协议

**第三版邮局协议 POP3：**   （对油价你的操作不会反应在服务器上）

- 授权阶段：用户代理需要向服务器发送用户名和口令。
- 事务处理阶段：用户代理向服务器发送POP3命令。
- 更新阶段：客户发出了 quit 命令，结束 POP3 会话。

**互联网邮件访问协议：**  （对邮件的操作会反应在服务器上）

IMAP 服务器将每个邮件与一个文件夹进行关联，通过 IMAP 收件人可以对邮件进行移动、查询、阅读、删除等操作。

**HTTP：**  Wen 邮件系统的邮件读取协议。

# 6 FTP

**文件传送协议 FTP ：**   在互联网的两个主机间实现文件互传的网络应用的应用层协议。

**FTP的服务器进程由两大部分组成：**

- 主进程：负责接受新的客户请求。
- 从属进程：负责处理单个客户请求，与具体客户进行交互。

**FTP 专门使用一个独立的控制连接传输控制信息，与传输文件信息进行分离，所以将 FTP 这种控制信息的传送方式称为带外控制。**

**FTP 是有状态的协议。**

# 7 P2P 应用

**P2P 应用特点：**

1. 应用的对等方是用户的计算机。
2. 很强的应用规模伸缩性。
3. 应用在对等方之间进行。
4. 应用充分聚集利用了端系统的计算能力以及网络传输带宽。

# 8 Socket 编程基础



**套接字（Socket）：**  典型的网络应用编程接口。

**端口号：**  标识套接字。

**Socket API 函数：**

- 创建套接字  socket()
- 绑定套接字的本地端点地址：bind()
- 设置监听：listen()
- 建立连接：
  - TCP客户端 connect()
  - TCP服务端 accept()
- 接收数据
  - TCP recv()
  - UDP recvfrom()
- 发送数据
  - TCP send()
  - UDP sendto()
- 关闭套接字 close()

**数据报类型套接字：**  SOCK_DGRAM  UDP

**流式套接字：**  SOCK_STREAM  TCP

**原始套接字：**  SOCK_RAW

