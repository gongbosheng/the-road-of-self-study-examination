# 一、 文件概述

C语言将文件看做是由一个一个的字符( ASCII码文件)或字节(二进制文件)组成的，这种文件称为流式文件。

## （1）文件定义

文件是存储在外部存储介质上的数据集合，这些数据的类型可以是整型、实型、字符型、字符串或结构体类型等。目前，外部存储介质主要是磁盘，存储在磁盘上的文件称为“磁盘文件”。

## （2）文件命名

-  c    C源程序文件
- obj  C 源程序经过编译后生成的目标文件
- exe  目标文件经过链接后生成的可执行文件

## （3） 文件分类

- 按照文件的内容划分，可分为程序文件和数据文件，程序文件可以分为 源文件，目标文件和可执行文件。
- 按照文件的组织形式划分，可分为顺序存取文件和随机存取文件。
- 按照存储形式， 可分为文本文件（将文本文件中数据转换为对应的 ASCLL 码存放）和二进制文件。
- 按照存储介质文件，普通文件即存储介质文件（磁盘，磁带），设备文件即非存储介质文件（键盘，显示器和打印机）。

## （4） 文件系统

- 缓冲文件系统（共享缓冲区）
- 非缓冲文件系统（文件独享缓冲区）



# 二、 文件操作

程序开始运行的时候，系统自动打开三种标准设备文件，分别定义了相应的文件型指针。

- stdin   标准输入
- stdout 标准输出
- stderr 标准错误

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void main()
{   
    FILE *fp;
    char ch[100];
    char filename[10] =  "./1.txt";
    fp = fopen(filename, "w+");
    if (fp == NULL)
    {
        printf("文件打开错误!\n");
        exit(0);
    }

    int seek = feof(fp);
    printf("指针位置： %d\n", seek);

    while (ch[0] != '#')
    {
        fprintf(fp,"%s\n",ch);
        // fputs(ch,fp);
        scanf("%s",ch);
        // fgets(ch,20,stdin);
        printf("%s", ch);
        getchar();
    }

    rewind(fp);
    char rn[1001];
    while (1)
    {
        fgets(rn, 1001, fp);
        if (feof(fp))
        {
            break;
        }
        printf("%s", rn);
        
    }
    fclose(fp);
}
```



## （1）文件打开函数

**[函数首部]** 

```
FILE * fopen(char *filename,char *mode)
```

**[参数]**  filename字符型指针，所指向的字符串是要打开的“文件名”，mode字符型指针，所指向的字符串是对打开文件规定的“使用方式”。“使用方式”是由r、W、a、t、b和+六个字符组成。如果使用方式中有b字符,则针对的是二进制文件;如果使用方式中没有b字符，则针对的是文本文件;如果使用r打开一个文件时，则该文件必须已经存在。

**[功能]**  按mode指定的“使用方式”打开filename指定的“文件名”对应的文件，同时自动地为该文件分配一个内存缓冲区。

**[返回值]**   若打开文件正确，则返回一个“文件型”指针，程序通过该指针获得文件信息，访问文件并进行各种操作。若打开文件出错，则返回值为NULL,其中NULL是在头文件stdio.h中定义的符号常量，其值为0，含义是“空”。

```c
FILE *fp;
fp = fopen("aa.c","w");
if(fp == NULL)
{
	printf("文件打开失败!\n")
	exit(0)
}
```

## （2）文件关闭函数

**[函数首部]**  

```c
int fclose(FILE *fp);
```

**[参数]** fp文件型指针，通过函数fopen()获得，且指向一个已经打开的文件。

**[功能]**关闭fp所指向的文件，同时自动释放分配给该文件的内存缓冲区。

**[返回值]** 若正确关闭指定的文件，则返回0;否则返回非0。

## （3）程序退出函数

**[函数首部]**  

```c
 void exit([程序状态值])
```

**[功能]** 关闭已经打开的所有文件，结束程序运行返回操作系统，并将“程序状态值”返回给操作系统。当“程序状态值”为0时，表示程序正常退出;当它为非0时,表示程序出错退出。

## （4） 文件尾测试函数


文件执行读操作时，通常使用feof( )函数来判断是否到达文件属。如果遇到文件尾,

**[函数首部]** 

```c
int feof(FILE *fp)
```

**[参数]** fp文件型指针，通过fopen()函数获得，指向一个已经开的文件。

**[功能]**  判断fp所指向的文件是否到达文件尾。

**[返回值]**  若遇到文件尾，则返回值是非0 否则，返回值是0。feof()函数同时适用于文本文件和二进制文件。对进制文件执行读操作时，必须使用feof()函数来判断是否到达文件尾;对文本文件执行读操作时，如果遇到文件尾，则返回一个文件结束标志EOF ( EOF是一个符号常量，其值在头文件stdio.h中被定义为-1，含义是“文件尾”)。

## （4）文件写

### a. 写字符

**[函数首部]**

```c
 int fputc(char ch,FILE *fp)
```

**[参数]**  ch写到文件中的字符，既可以是字符常量，也可以是字符变量或字符表达式。fp文件型指针，通过函数fopen()获得，且指向一个已经打开的文件。 .

**[功能]** 将ch中的字符写到fp所指向文件的当前位置，同时将读/写位置指针后移1字节，即指向下一个读/写位置。

 **[返回值]**  若正确写入字符，则返回刚写入到文件的字符;否则，返回EOF。入本函数主要用于文本文件，也可以用于二-进制文件。对于文本文件，写入的是单个字符。对于二进制文件，写入的是1字节数据。当正确地写入一个字符或1字节数据后，文件内部的读/写位置指针会后移1字节，即指向下一个读/写位置。

### b. 写字符串

**[函数首部]**

```c
int fputs(char ch[], FILE *fp)
```

**[参数]**  str字符型指针，可以是一个字符常量，或字符数组名，或字符指针变量名。fp文件型指针，通过函数fopen( )获得，指向一个已经打开的文件。 .

**[功能]** 把str所指向的一个字符串，舍去字符串结束标志符‘\0’后写入fp所指向文件的当前位置。同时将读/写位置指针向后移动strlen (字符串长度)字节。

**[返回值]** 若正确写入字符串，则返回写入文件的实际字符数;否则，返回EOF。

### c. 写数据块

**[函数首部]**

```c
 int fwrite(void *buffer ,int size,int count,FILE *fp)
```

**[参数]** 

buffer字符型指针，存放写入文件数据类型的起始地址，可以是存放数据的变量地址或数组首地址，也可以是指向某个变量或数组的指针变量。

size无符号整数，可以是整型常量、变量或表达式，表示从文件写入文件的每个数据所占用的字节数，通常使用表达式sizeof(数据类型符)。

count无符号整数，可以是整型常量、变量或表达式，表示要写入文件的数据的个数。

fp文件型指针，通过函数fopen()获得，指向一个已经打开的可写文件。

**[功能]**  将从buffer开始的count个数据(每个数据占用size字节)一次性写入fp所指向的文件。同时，将读/写位置指针后移size*count字节。

**[返回值 ]**  若正确写 入数据块，则返回值是count;否则，返回值是0。

### d. 格式化写函数

**[函数首部]**

```c
 int fprintf(FILE *fp,char *format,argument...])
```

**[参数]** 

fp文件型指针，通过函数fopen()获得，指向一个已经打开的可写文件。

format格式字符串。

argument输出列表。

**[功能] ** 将argument的值以format指定的格式写入fp所指向的文件。

**[返回值]**  若正确写入数据，则返回实际输出字符的个数;否则，返回值是负数。

## （5）文件读

### a. 读字符

**[函数首部]** 

```c
int fgetc(FILE *fp)
```

**[参数]** fp文件型指针，通过函数fopen()获得，指向一个已经打开的文件。

**[功能]** 从fp所指向文件的当前位置读取一个字符，同时将读/写位置指针后移1字节，即指向下一个读/写位置。

**[返回值]**若正确读取字符，则返回读取的单个字符;否则，返回EOF。

### b. 读字符串

**[函数首部]**

```c
char *fgets(char *str, int n, FILE *stream)
```

**[参数]**

 str - 这是一个指向数组的指针，其中存储了读取的字符串。 

 n - 读取的最大字符数(包括最后的空字符)。通常，使用作为str传递的数组的长度。 

steam − 这是指向FILE对象的指针，该对象标识读取字符的流。

**[返回值]**

如果成功，函数将返回相同的str参数。如果遇到了文件结束符，并且没有读取任何字符，则str的内容保持不变，并返回一个空指针。

### c. 读数据块

**[函数首部]** 

```c
int fread(void *buffer,int size,nt count,FIL E *fp)*
```

**[参数]** 

buffer字符型指针，存放从文件中读取数据的起始地址，可以是存放数据的变量地址或数组首地址，也可以是指向某个变量或数组的指针变量。

size无符号整数，可以是整型常量、变量或表达式，表示从文件读取的每个数据所占用的字节数，通常使用表达式sizeof(数据类型符)。

count无符号整数，可以是整型常量、变量或表达式，表示从文件中读取数据的个数。

fp文件型指针，通过函数fopen()获得，指向一个已经打开的可读文件。

**[功能]**  从fp所指向文件的当前位置开始，一次性读入count个数据(每个数据占用size字节)，并将读入的数据存放到以buffer为首地址的内存区;同时，将读/写位置指针后移size*count字节。

**[返回值]**  若正确读取数据块，则返回值是count;否则，返回值是0。需要注意的是，用fread()和fwrite( )函数进行数据读/写时，必须采用二进制。

### d. 格式化读

**[函数首部]**

```c
 int fscanf(FILE *fp,char *format,argument...])
```

**[参数]** 

fp文件型指针，通过函数fopen()获得，指向一个已经打开的可写文件。

format格式字符串。

argument输出列表。

**[功能] ** 将argument的值以format指定的格式写入fp所指向的文件。

**[返回值]**  若正确写入数据，则返回实际输出字符的个数;否则，返回值是负数。

## （6）定位

### a. 文件指针复位函数

**[函数首部]** 

```c
int rewind(FILE *fp)
```

**[参数]**  fp文件型指针，通过函数fopen()获得，指向一个已经打开的文件。

**[功能]**  将fp所指向文件的位置指针重置到文件头，即把文件的位置指针重新定位到fp所指向文件的起始位置。

**[返回值]**  若执行正常，返回值是0;否则，返回值是非0。

### b. 文件随机定位函数

>  文件随机定位函数fseek( )可以将文件的位置指针移动到文件中的任何一个地方,一般用于二进制。

**[函数首部]** 

```c
 int fseek(FILE *fp,long offset,int origin))
```

**[参数]** 

fp文件型指针，通过函数fopen()获得， 指向一个已经打开的文件。

offset长整型数据，表示位移量，是从origin为起始位置，向后(当位移量0时)或向前(当位移量<0时)移动的字节数。

origin表示起始位置。(0 文件头 1指针当前位置 2 文件尾)

**[功能]** 将fp所指向文件的位置指针从origin指定的起始位置移动offset所指定的字节数，改变文件位置指针的位置，即指向新的位置。

**[返回值]** 若定位成功，则返回值是0;否则，返回值是非0。

