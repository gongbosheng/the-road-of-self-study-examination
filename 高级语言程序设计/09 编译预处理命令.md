编译预处理是指对源程序进行编译之前，先对源程序中的各种预处理命令进行处理;然后再将处理结果和源程序一起进行编译，以获得目标代码。

# 一、 宏定义命令

C语言包括两种宏定义命令，即无参宏定义命令和有参宏定义命令。通常，宏定义用于定义程序中的符号常量、类型别名、运算式代换和语句代换等。

## （1） 无参宏定义

**[格式]**  

```c
#define PI 3.14
```

**[说明]**

1. “宏名”是标识符的一种，命名规则与标识符相同，通常采用大写字母，以便与变量区分;“字符序列”可以是常量、表达式各种符号等。“宏名” 和“字符序列”之间使用空格符分隔。
2. 宏定义不是C语言的语句，所以不能在行尾加分号。否则，宏展开时会将分号作为字符串的一个字符，用于替换宏名。
3. 宏展开时，预处理程序仅按宏定义简单地替换宏名，而不做任何检查。
4. 对于双引号括起来的字符串内的字符，即使与宏名重名，也不进行宏展开。
5. 宏定义命令#define出现在函数的外部，宏名的作用域是从宏定义开始到本文件结束。通常，宏定义命令放在文件的开头。
6. 宏定义时，可以引用已定义的宏名，宏展开是逐层替换的。

## （2） 带参数的宏定义

**[格式]**

```c
#define S(a) a*a
...
int x = 4, y = 6;
a = S(x+y);

// 宏展开 a = x+y*x+y 这样得到的结果是不对的


#define S(a) (a)*(a)
...
int x = 4, y = 6;
a = S(x+y);
// 宏展开 a = (x+y)*(x+y)
```

带参宏定义与函数的区别：

- 函数调用时，先求实参表达式的值，再带入形参。宏只进行简单字符替换，不求值。
- 函数调用在程序运行时处理和分配临时内存单元。宏展开在编译时进行，不分配内存单元，无值传递和返值。
- 函数要定义形实参且类型一致，宏无类型，其参数无类型。
- 函数只有一个返回值，宏可以设法得到几个结果。
- 宏展开使源程序变长，函数调用源程序不变长。
- 宏替换不占运行时间，只占编译时间。函数调用占运行时间。



# 二、 文件包含命令

文件包含是指一个源文件可以将另一个源文件的全部内容包含进来。文件包含命令可以将多个模块共用的数据( 如符号常量和数据结构)或函数，集中到一个单独的文件中。

文件包含命令的格式:

```c
#include "文件名"  // 系统首先到当前源文件所在的目录查找被包含文件，如果没有找到，再到系统指定的“包含文件目录”去查找，必要时在文件名前加.上所在的路径。
#include <文件名>  // 直接到系统指定的“包含文件目录”去查找。
```



1. 编译预处理时，预处理程序将查找指定的被包含文件，并将其复制到#include命令出现的位置上。
2. 文件头部的被包含文件称为“标题文件”或“头部文件”，常以“h”(head )作为扩展名，简称头文件。
3. 一条文件包含命令，只能指定一个被包含文件。
4. 由于库函数以及某些宏定义都存放在系统文件中，- -般都存放在系统指定的路径下，所以将存放库函数的头文件包含在源程序时一般建议采用格式二，即#include<文件名>。
5. 文件包含命令允许嵌套，即一个被包含的文件中可以再使用文件包含命令包含另一个文件，而在该文件中还可以再包含其他文件。
6. 若被包含文件的内容发生变化，则应该对包含此文件的所有源文件重新进行编译。

# 三、 条件编译命令

C语言提供了条件编译命令，使得用户可以选择对源程序的一部分内容进行编译,即不同的编译条件产生不同的目标程序。

```c
1.
#ifdef 标识符
	程序段 1
#else
  程序段 2
#endif
// 当 标识符已经被 #define 命令定义，则变异程序段1 否则便以程序段 2 
  
  
2.
#ifndef 标识符
	程序段 1
#else
  程序段 2
#endif
// 与上相反
  
3.
#if 表达式
	程序段 1
#else
  程序段 2
#endif
```

